---
title: "Part 3"
---


---

class: inverse, center, middle

# `r rfa("toolbox")` Towards the gold standard

![:custom_hr]()

## `r icon::fontawesome("clock")` ~ 30min


???

A word about setting up those tools depending on the environemnt.

---
# Gold standard 

```{R, echo = FALSE, out.width = "80%"}
kig("img/spectrum.png")
```

.font80[`r rfa("file")` Peng. (2011).
[Reproducible Research in Computational Science.](https://science.sciencemag.org/content/334/6060/1226)]

--

### Towards full reproducibility, technologies are getting more complex


- entire pipeline in a versioned repository


- record all version of software used in the workflow


- code run without being impacted by OS or hardware


???

A tool box of software 
Coding a lot


---
# Version control `r emj("hand")`

--

## Keep track of code changes...

- to talk about the same piece of code 

--

- to easy go back in time 

--

- to tag version of code 


---
# Version control with Git

### Local versioning

```{r, echo = FALSE, out.width = "50%"}
kig("https://git-scm.com/book/en/v2/images/local.png")
```

`r rfa("book")` Chacon & Straub (2014) [Pro Git](https://git-scm.com/book/en/v2/Getting-Started-About-Version-Control)

---
# Version control with Git

### Centralized version control

```{r, echo = FALSE, out.width = "50%"}
kig("https://git-scm.com/book/en/v2/images/centralized.png")
```

`r rfa("book")` Chacon & Straub (2014) [Pro Git](https://git-scm.com/book/en/v2/Getting-Started-About-Version-Control)


---
# Version control with Git

### Distributed version control such as Git

```{r, echo = FALSE, out.width = "42%"}
kig("https://git-scm.com/book/en/v2/images/distributed.png")
```

`r rfa("book")` Chacon & Straub (2014) [Pro Git](https://git-scm.com/book/en/v2/Getting-Started-About-Version-Control)


---
# Version control with Git `r emj("computer")`


```sh 
$ git init -b main 
$ git add -A 
$ git commit -m 'initial commit'
# do changes 
$ git add R/pipeline.R
$ git commit -m 'inform user when pipeline() ends'
# see history
$ git log
$ git checkout HEAD~1
# git revert HEAD~1..HEAD if going back needed
```



---
# Version control with Git + GitHub/Gitlab

```{r, echo = FALSE, out.width = "42%"}
kig("https://git-scm.com/book/en/v2/images/distributed.png")
```

### e.g. The [`r rfa("github")`](https://github.com/inSilecoInc/workshop_reproducibility) repository for this workshop !

???
 
push and pull
show repo



---
# Use a pipeline toolkit: [GNU Make](https://www.gnu.org/software/make/manual/make.html)

--

### 1. Create a file `makefile` (or `Makfile`)

<br>


### 2. Write down what it needs to do

```sh
ms: ms/ms.Rmd 
	Rscript -e 'rmarkdown::render("ms/ms.Rmd")'
```

<br>

### 3. Use `make` e.g. `make ms`


---
# Use a pipeline toolkit: [GNU Make](https://www.gnu.org/software/make/manual/make.html) `r emj("computer")`

<br>

--

`r rfa("blog")` Sachin Patil (2018) [What is a Makefile and how does it work?](https://opensource.com/article/18/8/what-how-makefile)



---
# Use a pipeline toolkit: [targets](https://www.gnu.org/software/make/manual/make.html)


```{r, echo = FALSE, out.width = "42%"}
kig("https://docs.ropensci.org/targets/reference/figures/logo.png")
```

`r rfa("book")` [The targets R Package User Manual](https://books.ropensci.org/targets/index.html#motivation)





---
# Structure your repo as an R package

## Why?

--

### 1. Because the structure of an R package is very relevant for research compendia

--

### 2. Because R developers are created great packages to develop packages!


--

`r rfa("file")` Marwick et al. (2018) [Packaging Data Analytical Work Reproducibly Using R (and Friends)](https://www.tandfonline.com/doi/abs/10.1080/00031305.2017.1375986)


---
# Structure your repo as an R package

## Basic structure of an R package 

```sh
.
├── DESCRIPTION 
├── doc
├── data
├── LICENSE
├── man
├── NAMESPACE
├── R
├── README.md
├── tests
└── vignettes
```

---
# Structure your repo as an R package

## Basic structure of an R package 

```sh
.
├── DESCRIPTION # includes info about package versions
├── doc         # include a website
├── data
├── LICENSE     # always good to specify a license 
├── man         # document function 
├── NAMESPACE   # no need 
├── R
├── README.md 
├── tests       # test your code 
└── vignettes   # include your ms 
```



---
# Make a R package !

## Is it an overkill? 

--

### **NO!**

--

- Jim Hester (2018) [You can make a package in 20 minutes](https://rstudio.com/resources/rstudioconf-2018/you-can-make-a-package-in-20-minutes-jim-hester/)

--

- The collection of packages fro developers makes every steps easy

--

- This is a very good avenue to go even further


???

Yes... it might be a steep learning curve but it's worth it.


---
# Make a R package !

## Benefit from popular development tools 

```{r, echo = FALSE, out.width = "42%"}
kig("https://raw.githubusercontent.com/r-lib/devtools/master/man/figures/logo.svg")
```

`r rfa("github")` [r-lib/devtools](https://github.com/r-lib/devtools/)


---
# Make a R package !

### It structures your workflow 

```R
library(devtools)
# load all functions
load_all()
# document functions and edit Namespace
document()
# test functions
test()
# check the package integrity
check()
```

???

shared workflow


---
# Make a R package !

## Benefit from popular development tools 

```{r, echo = FALSE, out.width = "42%"}
kig("https://raw.githubusercontent.com/r-lib/usethis/master/man/figures/logo.png")
```

`r rfa("github")` [r-lib/usethis](https://github.com/r-lib/usethis)



---
# Make a R package !

> usethis is a workflow package: it automates repetitive tasks that arise during project setup and development, both for R packages and non-package projects.

```R
library(usethis)
usethis::use_gpl_license()
usethis::use_citation() 
```


---
# Manage your dependencies 

## Different R versions, different results!


```R
# R 3.6
df <- data.frame(fact = rep(c("F1", "F2"), each = 5), val = runif(10))
plot(val ~ fact, data = df)   # works 
# R 4.0
df <- data.frame(fact = rep(c("F1", "F2"), each = 5), val = runif(10))
plot(val ~ fact, data = df)   # does not work
```


---
# Manage your dependencies

```{r, echo = FALSE, out.width = "50%"}
kig("https://raw.githubusercontent.com/rstudio/renv/master/man/figures/logo.svg")
``` 

`r rfa("github")` [rstudio/renv](https://github.com/rstudio/renv)

---
# Manage your dependencies

## Save all dependencies in renv.lock and install them later seamlessly

```R 
renv::init()
renv::snapshot()
# later (on another device)
renv::restore()
```

`r rfa("file")` [Introduction to renv](https://rstudio.github.io/renv/articles/renv.html)




---
# Continuous Integration (CI)

## Check your code on a freshly install machine 

--

### e.g. The [`r rfa("github")`](https://github.com/inSilecoInc/workshop_reproducibility/actions) repository for this workshop !

--

## Again, with an R package, everything goes smoothly 

```R
usethis::use_github_action_check_standard() 
```

???

start thinking about OS agnosticism


---
# Archive your repository

- [https://zenodo.org/](Zenodo)



```{R, echo = FALSE}
# # Dockerize 
# 
# - [docker](https://www.docker.com/) 
# 
# ---
# # Archive 
# 
# - reference [https://zenodo.org/](Zenodo)
# 
# ---
# # Holepunch
# 
# - once set up o GH 
# 
# https://github.com/karthik/holepunch
# 
# https://books.ropensci.org/targets/walkthrough.html#about-this-minimal-example
# https://github.com/ropensci/targets
# https://github.com/wlandau/targets-minimal
```